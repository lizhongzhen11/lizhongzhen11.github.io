<!DOCTYPE html>
<html lang="z">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>开发银联退款的经历 | Ronaldo</title>
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="可以参考：http://blog.csdn.net/haozhuxuan/article/details/53637243https://open.unionpay.com/upload/download/%E5%B9%B3%E5%8F%B0%E6%8E%A5%E5%85%A5%E6%8E%A5%E5%8F%A3%E8%A7%84%E8%8C%83-%E7%AC%AC5%E9%83%A8%E5%8">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="开发银联退款的经历 | Ronaldo">
    <meta name="twitter:description" content="可以参考：http://blog.csdn.net/haozhuxuan/article/details/53637243https://open.unionpay.com/upload/download/%E5%B9%B3%E5%8F%B0%E6%8E%A5%E5%85%A5%E6%8E%A5%E5%8F%A3%E8%A7%84%E8%8C%83-%E7%AC%AC5%E9%83%A8%E5%8">

    <meta property="og:type" content="article">
    <meta property="og:title" content="开发银联退款的经历 | Ronaldo">
    <meta property="og:description" content="可以参考：http://blog.csdn.net/haozhuxuan/article/details/53637243https://open.unionpay.com/upload/download/%E5%B9%B3%E5%8F%B0%E6%8E%A5%E5%85%A5%E6%8E%A5%E5%8F%A3%E8%A7%84%E8%8C%83-%E7%AC%AC5%E9%83%A8%E5%8">

    
    <meta name="author" content="lizhongzhen">
    
    <link rel="stylesheet" href="/css/vno.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">

    
    <link rel="icon" href="/images/logo.jpg">
    

    <meta name="generator" content="hexo"/>
    
    <link rel="alternate" type="application/rss+xml" title="Ronaldo" href="/atom.xml">
    

    <link rel="canonical" href="http://yoursite.com/2017/11/14/银联退款问题/"/>

                 
</head>

<body class="home-template no-js">
    <script src="//cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>

    
<header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/Daniel.jpg)">
  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/" title="前往 Ronaldo 的主页"><img src="/images/logo.jpg" width="80" alt="Ronaldo logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage for Ronaldo">Ronaldo</a></h1>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description"></p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />

        <div class="navigation-wrapper">
          <div>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="Blogを読む" class="blog-button">Blog</a></li>
            
            </ul>
          </nav>
          </div>
          <div>
          <nav class="cover-navigation navigation--social">
  <ul class="navigation">

  <!-- Weibo-->
  
  <li class="navigation__item">
    <a href="http://weibo.com/3298783260/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo" title="Weibo" target="_blank">
      <i class='social fa fa-weibo'></i>
      <span class="label">Weibo</span>
    </a>
  </li> 


  <!-- Github -->
  
  <li class="navigation__item">
    <a href="https://github.com/lizhongzhen11" title="GitHub" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>


<!-- Stack Overflow -->
        

  <!-- Google Plus -->
  

<!-- Facebook -->

  
<!-- Twitter -->

  

  <li class="navigation__item">
    <a href="/atom.xml" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>



  </ul>
</nav>

          </div>
        </div>

      </div>

    </div>

    <div class="panel-cover--overlay cover-purple"></div>
  </div> 
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single">

  <header class="post-header">
    <div class="post-meta">
      <time datetime="2017-11-14T09:29:22.267Z" class="post-list__meta--date date">2017-11-14</time> &#8226; <span class="post-meta__tags tags">于  </span>
      <span class="page-pv">
       No. <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>
      </span> 
   
    </div>
    <h1 class="post-title">开发银联退款的经历</h1>
  </header>

  <section class="post">
    <p>可以参考：<a href="http://blog.csdn.net/haozhuxuan/article/details/53637243" target="_blank" rel="external">http://blog.csdn.net/haozhuxuan/article/details/53637243</a><br><a href="https://open.unionpay.com/upload/download/%E5%B9%B3%E5%8F%B0%E6%8E%A5%E5%85%A5%E6%8E%A5%E5%8F%A3%E8%A7%84%E8%8C%83-%E7%AC%AC5%E9%83%A8%E5%88%86-%E9%99%84%E5%BD%95V2.2.pdf" target="_blank" rel="external">https://open.unionpay.com/upload/download/%E5%B9%B3%E5%8F%B0%E6%8E%A5%E5%85%A5%E6%8E%A5%E5%8F%A3%E8%A7%84%E8%8C%83-%E7%AC%AC5%E9%83%A8%E5%88%86-%E9%99%84%E5%BD%95V2.2.pdf</a><br><a href="https://open.unionpay.com/ajweb/help/file/techFile?productId=1" target="_blank" rel="external">https://open.unionpay.com/ajweb/help/file/techFile?productId=1</a></p>
<h3 id="本次开发后台是struts框架，不是SpringMVC"><a href="#本次开发后台是struts框架，不是SpringMVC" class="headerlink" title="本次开发后台是struts框架，不是SpringMVC!!!"></a>本次开发后台是struts框架，不是SpringMVC!!!</h3><p><strong>上周五组长安排我把后台管理系统的银联退款写好，由于支付宝和微信退款其他人早就写好了，我想照着抄抄不就OK了吗？</strong><br><strong>嗯，我想多了。</strong><br>同事之前开发银联支付把支付的坑踩得差不多了，我想退款开发起来很简单吧。肯定有退款接口吧。<br>然后同事把银联相关知识文档地址发给我。<br>老实说，我打开一看，这些都什么啊，怎么这么多分类啊，哪个对哪个啊。<br>不多说，问。<br>哦，她选的是网关支付，然后我傻兮兮的找了半天，退款呢？？？Excuse me? Where is my 退款???<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;不吹不黑，第一次独立开发java这种级别的接口，要自己看官方文档，真的是一头雾水。。。完全不知道看哪个，都花了。然后百度，看到一个java写的，用的SpringMVC，我一看，嗯，亲切，好歹用过啊。整篇复制粘贴，改点数据应该哦了吧！<br>当然不可能啦！<br>倒是看看他的文件位置和内容，我又对照着同事写的支付，咦，SDK一样的，web文件夹下面两个类文件一样的，还有其他的，直接拿过来用。<br><img src="../../../../images/yl1.png" alt=""><br>但是，毕竟小白第一次，很晕。怎么调都不会，很惭愧。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后来，同事告诉我哪个是我们要用的官方文档加示例，下载下来， 打开一看，一堆红，有点慌，仔细看看，原来是jar包没导入，没事。看看方法，嗯?<code>doPost,doGet</code>，这不是<code>HttpServlet</code>的方法吗，这貌似好像是页面跳转时才能用吧。我这写在独立的银联支付文件夹下面的怎么搞，我真不知道(因为支付宝和微信都是写在该层的)。然后看看同事开发的支付代码，由于是另一个项目，用的<strong>SpringMVC</strong>，<code>@RequestMapping</code>看着就很熟，遂，抄。参数照着抄。<br>运行，失败。。。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;问了旁边的熊，他说，<strong>struts</strong>和<strong>SpringMVC</strong>是两个框架，<code>@RequestMapping</code>是<strong>SpringMVC</strong>的注解，<strong>struts</strong>不能用，只能用<strong>action</strong>层的那种方式，但是，你想采用那种方式进行地址访问必须写在<strong>action</strong>层。<br>但是，我想照着下面支付宝调用的方法写，官方给的却是<code>doPost</code>方法，我没辙了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">String zfbresult = Alipay.alipayRefundRequest(oreturn.getOrderid(), oreturn.getAppid(), oreturn.getReturnprice());</div></pre></td></tr></table></figure></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;就这样，一直纠结着。。。几乎一天。没法子，厚着脸求教师傅，师傅一过来，看看官方案例，再对比下开发好的支付代码，只见他刷刷刷，复制粘贴，改参数，全程3分钟，OK。<br>我感到绝望，泪如雨下。。。。。。<br>不过他是把代码全写在<strong>service</strong>层的，没有像支付宝微信那样独立两个文件利用静态方法的形式来调用。<br>但是我还是想像支付宝微信那样的架构，不想全写在<strong>service</strong>里，那我该怎么办呢？</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我还是硬着头皮模仿支付宝方法开头去写了，只是把师傅帮我写好的代码全复制粘贴进去，然后，其实很明了了，需要什么数据传过来不就好了。<br>接下来就简单了，把官方案例复制过来，改改参数然后开启debug不断调试。</p>
<blockquote>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;调试也是令人心碎，一开始报35，“原订单不存在或状态不正确”，这是因为我一开始不知道怎么得到<code>queryId</code>(支付流水号)，这个是必须的，不然找不到。后来仔细读官方接口，才发现可以通过查询接口得到(我写在YlpayInquire.java)。后来又报“重复交易”，我开始怀疑是不是接口掉错了，但是仔细对比，并没有错，不得已，继续百度，终于找到原因，这是因为我提交退款的订单号和当时提交支付的订单号是一样的，我们正常想法觉得肯定是一样的啊，但是银联接口规定的<strong>商户订单号，8-40位数字字母，不能含“-”或“_”，可以自行定制规则，重新产生，不同于原消费</strong>，这里不同于原消费就是告诉我们不能和原来的订单号一样，这也是个坑，幸好网上有人踩过并贴出来，不然我还不知道要卡多久呢。</p>
</blockquote>
<p><strong>注意：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data.put(&quot;orderId&quot;,  Ylconfig.getOrderId());       //商户订单号，8-40位数字字母，不能含“-”或“_”，</div><div class="line">//可以自行定制规则，重新产生，不同于原消费(不能和支付时的订单号一样，否则报重复提交)</div><div class="line">data.put(&quot;origQryId&quot;, queryId);   			  //【原始交易流水号】，原消费交易返回的的queryId，</div><div class="line">//可以从消费交易后台通知接口中或者交易状态查询接口中获取</div></pre></td></tr></table></figure></p>
<p>还是贴源码吧：<br>Ylpay.java:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">public class Ylpay &#123;</div><div class="line">	public static String ylpayRefundRequest(String orderid, String app_id, String returnid, double returnprice) &#123;</div><div class="line">		SDKConfig.getConfig().loadPropertiesFromSrc(); //从classpath加载acp_sdk.properties文件</div><div class="line">		String resMsg = &quot;&quot;;</div><div class="line">		try &#123;</div><div class="line">			String queryId = YlpayInquire.YlpayInquire(orderid, Ylconfig.getCurrentTime(), app_id);</div><div class="line">			String txnAmt = String.valueOf((int)Math.abs(returnprice*100));</div><div class="line">			Map&lt;String, String&gt; data = new HashMap&lt;String, String&gt;();</div><div class="line">			/***银联全渠道系统，产品参数，除了encoding自行选择外其他不需修改***/</div><div class="line">			data.put(&quot;version&quot;, Ylconfig.version);            //版本号</div><div class="line">			data.put(&quot;encoding&quot;, Ylconfig.encoding);          //字符集编码 可以使用UTF-8,GBK两种方式</div><div class="line">			data.put(&quot;signMethod&quot;, SDKConfig.getConfig().getSignMethod()); //签名方法</div><div class="line">			data.put(&quot;txnType&quot;, &quot;04&quot;);                        //交易类型 04-退货</div><div class="line">			data.put(&quot;txnSubType&quot;, &quot;00&quot;);                     //交易子类型  默认00</div><div class="line">			data.put(&quot;bizType&quot;, &quot;000201&quot;);                    //业务类型 B2C网关支付，手机wap支付</div><div class="line">			data.put(&quot;channelType&quot;, &quot;07&quot;);                    //渠道类型，07-PC，08-手机</div><div class="line">			/***商户接入参数***/</div><div class="line">			data.put(&quot;merId&quot;, &quot;700000000000001&quot;);             //商户号码，请改成自己申请的商户号或者open上注册得来的777商户号测试</div><div class="line">			data.put(&quot;accessType&quot;, &quot;0&quot;);                      //接入类型，商户接入固定填0，不需修改	</div><div class="line">			data.put(&quot;orderId&quot;,  Ylconfig.getOrderId());       //商户订单号，8-40位数字字母，</div><div class="line">            //不能含“-”或“_”，可以自行定制规则，重新产生，不同于原消费(不能和支付时的订单号一样，否则报重复提交)	</div><div class="line">			data.put(&quot;txnTime&quot;, Ylconfig.getCurrentTime());   //订单发送时间，格式为YYYYMMDDhhmmss，</div><div class="line">            //必须取当前时间，否则会报txnTime无效</div><div class="line">			data.put(&quot;currencyCode&quot;, &quot;156&quot;);                  //交易币种(境内商户一般是156 人民币)</div><div class="line">			data.put(&quot;txnAmt&quot;, txnAmt);                       //【撤销金额】，消费撤销时必须和原消费金额相同	</div><div class="line">			//data.put(&quot;reqReserved&quot;, &quot;透传信息&quot;);                 //请求方保留域，，如需使用请启用即可；</div><div class="line">            //透传字段（可以实现商户自定义参数的追踪）本交易的后台通知,</div><div class="line">            //对本交易的交易状态查询交易、对账文件中均会原样返回，商户可以按需上传，长度为1-1024个字节。</div><div class="line">            //出现&amp;=&#123;&#125;[]符号时可能导致查询接口应答报文解析失败，</div><div class="line">            //建议尽量只传字母数字并使用|分割，或者可以最外层做一次base64编码</div><div class="line">            //(base64编码之后出现的等号不会导致解析失败可以不用管)。		</div><div class="line">			data.put(&quot;backUrl&quot;, Ylconfig.backUrl);            //后台通知地址，后台通知参数详见</div><div class="line">            //open.unionpay.com帮助中心 下载  产品接口规范  网关支付产品接口规范 消费撤销交易 商户通知,</div><div class="line">            //其他说明同消费交易的商户通知</div><div class="line">			/***要调通交易以下字段必须修改***/</div><div class="line">			data.put(&quot;origQryId&quot;, queryId);   			  //【原始交易流水号】，原消费交易返回的的queryId,</div><div class="line">            //可以从消费交易后台通知接口中或者交易状态查询接口中获取</div><div class="line">			/**请求参数设置完毕，以下对请求参数进行签名并发送http post请求，接收同步应答报文**/</div><div class="line">			Map&lt;String, String&gt; reqData  = AcpService.sign(data,Ylconfig.encoding);//报文中certId,signature的值是在signData方法中获取并自动赋值的，只要证书配置正确即可。</div><div class="line">			String reqUrl = SDKConfig.getConfig().getBackRequestUrl();//交易请求url从配置文件读取对应属性文件acp_sdk.properties中的 acpsdk.backTransUrl</div><div class="line">			Map&lt;String,String&gt; rspData = AcpService.post(reqData,reqUrl,Ylconfig.encoding);//发送请求报文并接受同步应答（默认连接超时时间30秒，读取返回结果超时时间30秒）;</div><div class="line">            //这里调用signData之后，调用submitUrl之前不能对submitFromData中的键值对做任何修改，如果修改会导致验签不通过</div><div class="line">			/**对应答码的处理，请根据您的业务逻辑来编写程序,以下应答码处理逻辑仅供参考-------------&gt;**/</div><div class="line">			//应答码规范参考open.unionpay.com帮助中心 下载  产品接口规范  《平台接入接口规范-第5部分-附录》</div><div class="line">			if(!rspData.isEmpty())&#123;</div><div class="line">				if(AcpService.validate(rspData, Ylconfig.encoding))&#123;</div><div class="line">					LogUtil.writeLog(&quot;验证签名成功&quot;);</div><div class="line">					String respCode = rspData.get(&quot;respCode&quot;);</div><div class="line">					resMsg = rspData.get(&quot;respMsg&quot;);</div><div class="line">					if(&quot;00&quot;.equals(respCode))&#123;</div><div class="line">						//交易已受理(不代表交易已成功），等待接收后台通知确定交易成功，也可以主动发起 查询交易确定交易状态。</div><div class="line">						//TODO</div><div class="line">						System.out.println(&quot;respCode = 00&quot;);</div><div class="line">						System.out.println(&quot;申请退款成功!等待银联处理&quot;);</div><div class="line">					&#125;else if(&quot;03&quot;.equals(respCode) ||</div><div class="line">							 &quot;04&quot;.equals(respCode) ||</div><div class="line">							 &quot;05&quot;.equals(respCode))&#123;</div><div class="line">						//后续需发起交易状态查询交易确定交易状态。</div><div class="line">						//TODO</div><div class="line">						System.out.println(&quot;退款失败1&quot;);</div><div class="line">					&#125;else&#123;</div><div class="line">						//其他应答码为失败请排查原因</div><div class="line">						//TODO</div><div class="line">						System.out.println(&quot;退款失败2&quot;);</div><div class="line">					&#125;</div><div class="line">				&#125;else&#123;</div><div class="line">					LogUtil.writeErrorLog(&quot;验证签名失败&quot;);</div><div class="line">					//TODO 检查验证签名失败的原因</div><div class="line">					System.out.println(&quot;退款失败3&quot;);</div><div class="line">				&#125;</div><div class="line">			&#125;else&#123;</div><div class="line">				//未返回正确的http状态</div><div class="line">				LogUtil.writeErrorLog(&quot;未获取到返回报文或返回http状态码非200&quot;);</div><div class="line">			&#125;</div><div class="line">			String reqMessage = Ylconfig.genHtmlResult(reqData);</div><div class="line">			String rspMessage = Ylconfig.genHtmlResult(rspData);</div><div class="line">		&#125; catch (Exception e) &#123;</div><div class="line">			// TODO: handle exception</div><div class="line">		&#125;</div><div class="line">		return resMsg;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>YlpayInquire.java:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">public class YlpayInquire &#123;</div><div class="line">	public static String YlpayInquire(String orderId, String txnTime, String app_id) &#123;</div><div class="line">		String reqMessage = &quot;&quot;;</div><div class="line">		String rspMessage = &quot;&quot;;</div><div class="line">		String queryId = &quot;&quot;;</div><div class="line">		SDKConfig.getConfig().loadPropertiesFromSrc(); //从classpath加载acp_sdk.properties文件</div><div class="line">		try&#123;</div><div class="line">			Map&lt;String, String&gt; data = new HashMap&lt;String, String&gt;();</div><div class="line">			/***银联全渠道系统，产品参数，除了encoding自行选择外其他不需修改***/</div><div class="line">			data.put(&quot;version&quot;, Ylconfig.version);                 //版本号</div><div class="line">			data.put(&quot;encoding&quot;, Ylconfig.encoding);               //字符集编码 可以使用UTF-8,GBK两种方式</div><div class="line">			data.put(&quot;signMethod&quot;, SDKConfig.getConfig().getSignMethod()); //签名方法</div><div class="line">			data.put(&quot;txnType&quot;, &quot;00&quot;);                             //交易类型 00-默认</div><div class="line">			data.put(&quot;txnSubType&quot;, &quot;00&quot;);                          //交易子类型  默认00</div><div class="line">			data.put(&quot;bizType&quot;, &quot;000201&quot;);                         //业务类型 B2C网关支付，手机wap支付</div><div class="line">			/***商户接入参数***/</div><div class="line">			data.put(&quot;merId&quot;, &quot;700000000000001&quot;);                  //商户号码，请改成自己申请的商户号或者open上注册得来的777商户号测试</div><div class="line">			data.put(&quot;accessType&quot;, &quot;0&quot;);                           //接入类型，商户接入固定填0，不需修改</div><div class="line">			/***要调通交易以下字段必须修改***/</div><div class="line">			data.put(&quot;orderId&quot;, orderId);                 //****商户订单号，每次发交易测试需修改为被查询的交易的订单号</div><div class="line">			data.put(&quot;txnTime&quot;, txnTime);                 //****订单发送时间，每次发交易测试需修改为被查询的交易的订单发送时间</div><div class="line">			/**请求参数设置完毕，以下对请求参数进行签名并发送http post请求，接收同步应答报文-------------&gt;**/</div><div class="line">			Map&lt;String, String&gt; reqData = AcpService.sign(data,Ylconfig.encoding);//报文中certId,signature的值是在signData方法中获取并自动赋值的，只要证书配置正确即可。</div><div class="line">			String url = SDKConfig.getConfig().getSingleQueryUrl();// 交易请求url从配置文件读取对应属性文件acp_sdk.properties中的 acpsdk.singleQueryUrl</div><div class="line">			//这里调用signData之后，调用submitUrl之前不能对submitFromData中的键值对做任何修改，如果修改会导致验签不通过</div><div class="line">			Map&lt;String, String&gt; rspData = AcpService.post(reqData,url,Ylconfig.encoding);</div><div class="line">			/**对应答码的处理，请根据您的业务逻辑来编写程序,以下应答码处理逻辑仅供参考-------------&gt;**/</div><div class="line">			//应答码规范参考open.unionpay.com帮助中心 下载  产品接口规范  《平台接入接口规范-第5部分-附录》</div><div class="line">			if(!rspData.isEmpty())&#123;</div><div class="line">				if(AcpService.validate(rspData, Ylconfig.encoding))&#123;</div><div class="line">					LogUtil.writeLog(&quot;验证签名成功&quot;);</div><div class="line">					queryId = rspData.get(&quot;queryId&quot;);</div><div class="line">					if(&quot;00&quot;.equals(rspData.get(&quot;respCode&quot;)))&#123;//如果查询交易成功</div><div class="line">						//处理被查询交易的应答码逻辑</div><div class="line">						String origRespCode = rspData.get(&quot;origRespCode&quot;);</div><div class="line">						if(&quot;00&quot;.equals(origRespCode))&#123;</div><div class="line">							//交易成功，更新商户订单状态</div><div class="line">							//TODO</div><div class="line">						&#125;else if(&quot;03&quot;.equals(origRespCode) ||</div><div class="line">								 &quot;04&quot;.equals(origRespCode) ||</div><div class="line">								 &quot;05&quot;.equals(origRespCode))&#123;</div><div class="line">							//需再次发起交易状态查询交易 </div><div class="line">							//TODO</div><div class="line">						&#125;else&#123;</div><div class="line">							//其他应答码为失败请排查原因</div><div class="line">							//TODO</div><div class="line">						&#125;</div><div class="line">					&#125;else&#123;//查询交易本身失败，或者未查到原交易，检查查询交易报文要素</div><div class="line">						//TODO</div><div class="line">					&#125;</div><div class="line">				&#125;else&#123;</div><div class="line">					LogUtil.writeErrorLog(&quot;验证签名失败&quot;);</div><div class="line">					//TODO 检查验证签名失败的原因</div><div class="line">				&#125;</div><div class="line">			&#125;else&#123;</div><div class="line">				//未返回正确的http状态</div><div class="line">				LogUtil.writeErrorLog(&quot;未获取到返回报文或返回http状态码非200&quot;);</div><div class="line">			&#125;</div><div class="line">			reqMessage = Ylconfig.genHtmlResult(reqData);</div><div class="line">			rspMessage = Ylconfig.genHtmlResult(rspData);</div><div class="line">		&#125; catch(Exception e) &#123;</div><div class="line">		&#125;</div><div class="line">		System.out.println(queryId);</div><div class="line">		return queryId;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="struts退款回调问题"><a href="#struts退款回调问题" class="headerlink" title="struts退款回调问题"></a>struts退款回调问题</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;因为退款回调地址必须能被银联访问到，所以需要在服务器上测试。之前一直以为弄好了，结果以上服务器，回调验签失败，整个人都懵逼了。然后和熊、苍老师一起研究，然后他们说要写在<strong>action</strong>层，好，写在了action层，但是代码貌似不对啊，原来的是SpringMVC的写法<br>SpringMVC写法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">	 * 返回后台通知</div><div class="line">	 * @param request</div><div class="line">	 * @param response</div><div class="line">	 */</div><div class="line">	@RequestMapping(value = &quot;/backRcvResponse&quot;)</div><div class="line">	public void BackRcvResponse( HttpServletRequest req, HttpServletResponse resp) &#123;</div><div class="line">		ReturnValue rtv = new ReturnValue();</div><div class="line">		...</div></pre></td></tr></table></figure></p>
<p>但是经我试验，struts不能这样写，后来经过不断地修改，摸索，改成了下面这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">	 * 返回后台通知</div><div class="line">	 * @param request</div><div class="line">	 * @param response</div><div class="line">	 */</div><div class="line">	@AuthMethod(Menus = &quot;&quot;, Auth = MenuAuth.Modify, OutType = ActionOutType.Bean)</div><div class="line">	public String BackRcvResponsess() throws Exception  &#123;</div><div class="line">		System.out.println(&quot;BackRcvResponsess===&quot;);</div><div class="line">		HttpServletRequest req = ServletActionContext.getRequest();</div><div class="line">		HttpServletResponse resp = ServletActionContext.getResponse(); </div><div class="line">		ReturnValue rtv = new ReturnValue();</div><div class="line">		try &#123;</div><div class="line">		SDKConfig.getConfig().loadPropertiesFromSrc(); //从classpath加载acp_sdk.properties文件</div><div class="line">		System.out.println(&quot;BackRcvResponsess接收后台通知开始&quot;);</div><div class="line">		System.out.println(&quot;req11111111111111111111111111&quot;+req);</div><div class="line">		// 获取银联通知服务器发送的后台通知参数</div><div class="line">		Map&lt;String, String&gt; reqParam = getAllRequestParam(req);</div><div class="line">		String encoding = req.getParameter(SDKConstants.param_encoding);</div><div class="line">//		System.out.println(reqParam);</div><div class="line">		//重要！验证签名前不要修改reqParam中的键值对的内容，否则会验签不过</div><div class="line">		if (!AcpService.validate(reqParam, encoding)) &#123;</div><div class="line">			System.out.println(reqParam.get(&quot;respMsg&quot;)+&quot;======&quot;+reqParam.get(&quot;respCode&quot;));</div><div class="line">			System.out.println(&quot;验证签名结果[失败].&quot;);</div><div class="line">			//验签失败，需解决验签问题</div><div class="line">		&#125; else &#123;</div><div class="line">			System.out.println(&quot;验证签名结果[成功].&quot;);</div><div class="line">			//【注：为了安全验签成功才应该写商户的成功处理逻辑】交易成功，更新商户订单状态</div><div class="line">			String orderId =reqParam.get(&quot;orderId&quot;); //获取后台通知的数据，其他字段也可用类似方式获取</div><div class="line">			String respCode = reqParam.get(&quot;respCode&quot;);</div><div class="line">			//判断respCode=00、A6后，对涉及资金类的交易，请再发起查询接口查询，确定交易成功后更新数据库。</div><div class="line">			System.out.println(&quot;===========&quot;+respCode+&quot;=========&quot;+orderId);</div><div class="line">		&#125;</div><div class="line">		System.out.println(&quot;BackRcvResponsess接收后台通知结束&quot;);</div><div class="line">		//返回给银联服务器http 200  状态码</div><div class="line">		resp.getWriter().print(&quot;ok&quot;);</div><div class="line">		&#125; catch (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		return null;</div><div class="line">		</div><div class="line">	&#125;</div><div class="line">	&lt;!------------------------------------------------&gt;</div><div class="line">	/**</div><div class="line">	 * 获取请求参数中所有的信息</div><div class="line">	 * 当商户上送frontUrl或backUrl地址中带有参数信息的时候，</div><div class="line">	 * 这种方式会将url地址中的参数读到map中，会导多出来这些信息从而致验签失败，这个时候可以自行修改过滤掉url中的参数或者使用getAllRequestParamStream方法。</div><div class="line">	 * @param request</div><div class="line">	 * @return</div><div class="line">	 */</div><div class="line">	public static Map&lt;String, String&gt; getAllRequestParam(</div><div class="line">			final HttpServletRequest request) &#123;</div><div class="line">		Map&lt;String, String&gt; res = new HashMap&lt;String, String&gt;();</div><div class="line">		Enumeration&lt;?&gt; temp = request.getParameterNames();</div><div class="line">		System.out.println(&quot;getAllRequestParam方法:&quot;+temp+&quot;cccccccccccccccccccccc&quot;);</div><div class="line">		if (null != temp) &#123;</div><div class="line">			while (temp.hasMoreElements()) &#123;</div><div class="line">				String en = (String) temp.nextElement();</div><div class="line">				String value = request.getParameter(en);</div><div class="line">				//System.out.println(&quot;eneneneneneneenen:&quot;+en);</div><div class="line">				//System.out.println(&quot;value==================:&quot;+value);</div><div class="line">				if(value.indexOf(&quot;-BEGIN CERTIFICATE-&quot;) != -1) &#123;</div><div class="line">					value = &quot;----&quot; + value.substring(0, 19) + &quot;----&quot; + value.substring(19, value.length()-17) + &quot;----&quot; +</div><div class="line">							value.substring(value.length()-17, value.length()) + &quot;----&quot;;</div><div class="line">				&#125;</div><div class="line">				res.put(en, value);</div><div class="line">				// 在报文上送时，如果字段的值为空，则不上送&lt;下面的处理为在获取所有参数数据时，判断若值为空，则删除这个字段&gt;</div><div class="line">				if (res.get(en) == null || &quot;&quot;.equals(res.get(en))) &#123;</div><div class="line">					// System.out.println(&quot;======为空的字段名====&quot;+en);</div><div class="line">					res.remove(en);</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		return res;</div><div class="line">	&#125;</div><div class="line">	&lt;!------------------------------------------------&gt;</div><div class="line">	/**</div><div class="line">	  * 获取请求参数中所有的信息。</div><div class="line">	  * 非struts可以改用此方法获取，好处是可以过滤掉request.getParameter方法过滤不掉的url中的参数。</div><div class="line">	  * struts可能对某些content-type会提前读取参数导致从inputstream读不到信息，所以可能用不了这个方法。理论应该可以调整struts配置使不影响，但请自己去研究。</div><div class="line">	  * 调用本方法之前不能调用req.getParameter(&quot;key&quot;);这种方法，否则会导致request取不到输入流。</div><div class="line">	  * @param request</div><div class="line">	  * @return</div><div class="line">	  */</div><div class="line">	 public static Map&lt;String, String&gt; getAllRequestParamStream(</div><div class="line">	   final HttpServletRequest request) &#123;</div><div class="line">		  Map&lt;String, String&gt; res = new HashMap&lt;String, String&gt;();</div><div class="line">		  try &#123;</div><div class="line">		   String notifyStr = new String(IOUtils.toByteArray(request.getInputStream()),Ylconfig.encoding);</div><div class="line">		   System.out.println(&quot;收到通知报文：&quot; + notifyStr);</div><div class="line">		   String[] kvs= notifyStr.split(&quot;&amp;&quot;);</div><div class="line">		   for(String kv : kvs)&#123;</div><div class="line">		    String[] tmp = kv.split(&quot;=&quot;);</div><div class="line">		    if(tmp.length &gt;= 2)&#123;</div><div class="line">		     String key = tmp[0];</div><div class="line">		     String value = URLDecoder.decode(tmp[1],Ylconfig.encoding);</div><div class="line">		     res.put(key, value);</div><div class="line">		    &#125;</div><div class="line">		   &#125;</div><div class="line">		  &#125; catch (UnsupportedEncodingException e) &#123;</div><div class="line">		   System.out.println(&quot;getAllRequestParamStream.UnsupportedEncodingException error: &quot; + e.getClass() + &quot;:&quot; + e.getMessage());</div><div class="line">		  &#125; catch (IOException e) &#123;</div><div class="line">		   System.out.println(&quot;getAllRequestParamStream.IOException error: &quot; + e.getClass() + &quot;:&quot; + e.getMessage());</div><div class="line">		  &#125;</div><div class="line">		  return res;</div><div class="line">	 &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>上面的代码是我经过连续3天不断调试、查找以及思考才想到的，真的菜啊。尤其是<code>getAllRequestParam()</code>里面的方法，经过我不断测试，对比(同事后来把回调写在另一个SpringMVC项目里结果成功了)成功的打印输出信息，终于发现加密文内容被修改了！！！</p>
</blockquote>
<p><strong>仔细对比:</strong><br>成功加密截图:<br><img src="../../../../images/ylsuccess.png" alt=""><br>失败加密截图:<br><img src="../../../../images/ylfail.png" alt=""></p>
<blockquote>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;通过截图的加密信息对比，可以看到，加密内容被破坏了，后来一路追踪找到了原因，就是在<code>getAllRequestParam()</code>该方法中被破坏的！<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;仔细看方法上边的注释,<strong>这种方式会将url地址中的参数读到map中，会导多出来这些信息从而致验签失败，这个时候可以自行修改过滤掉url中的参数或者使用</strong>,这种方法本身就具有风险性，需要我们自行修改！！！<br>后来我抱着尝试的心态，对该加密内容进行了最low的拼接字符串操作，然后试验了下，成功了！！！</p>
</blockquote>
<p><strong>坑真的是太多了！！！当成功二字出现的时候，我急乎要哭了！！！</strong></p>
<h3 id="追加。。。"><a href="#追加。。。" class="headerlink" title="追加。。。"></a>追加。。。</h3><blockquote>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;稳妥起见，我打算通过回调成功与否来决定是否修改订单状态，好吧，坑又来了<br>由于原先的退款代码(包括支付宝和微信)写在service层,所以只要一跑通不出问题,就会直接往下走去修改订单状态，也就是说不管银联有没有回调成功，只要退款接口返回成功它就修改订单状态了，这样不好，不够稳妥。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我的第一次尝试：希望声明个类似js的全局变量，但是action层改变后service层也能访问到改变后的值，当时想法提出来但是不会实施了，毕竟不是专业的java,然后请教组长，组长说这样不大好,然后晚上跟熊商量了下，他直接否决，因为我没考虑到多人同时访问该方法的情况，如果多人同时访问该方法，有的退款成功的，该变量值会改变但是有的失败呢，这就比较烦了。失败。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;第二次尝试：苍老师说银联会返回给你什么，比如订单号之类的，可以通过那个去查。我一想，对啊，银联确实返回给了我订单号等一大堆的东西，我直接通过订单号不就可以查到订单了吗，然后去修改订单状态。<br>果断实施,失败。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;由于不想银联退款接口一成功就修改订单状态,所以做了修改，当退款接口返回成功时直接return掉，通过回调方法重新调一个修改订单状态的方法,需要专门重写一个。<br>这里又踩了坑！！！<br><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;银联返回的订单号并不是我们数据库里的订单号，因为退款接口里明确说了，该订单号不能和原来的交易订单号相同，我也试验了，会报重复交易的错。</strong><br>该怎么办呢？根据交易流水号来查！<br>但是一开始做支付时并没有存交易流水号，所以数据库里空荡荡。。。<br>支付时记得把交易流水号写进去，退款回调时才能根据流水号查到订单号。</p>
</blockquote>
<h3 id="补充于2018-01-02"><a href="#补充于2018-01-02" class="headerlink" title="补充于2018-01-02"></a>补充于2018-01-02</h3><p>元旦前夕,测试说他之前的订单有个不能退款,当时我就吓了一跳。。。</p>
<blockquote>
<p>该订单背景:</p>
</blockquote>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;该订单是他几天前下的,一直忘了退款,直到12月29号才去退款,发现退不了,返回报文格式错误。我当时就看后台返回的内容,发现报文里面没有流水号等某些必须的字段,我立即想到会不会是代码合并被覆盖掉的原因,仔细一想也不大可能,毕竟其他人没动过这里,这边全是我写的。以防万一,我自己下了个订单试试,结果没问题能退款,看请求报文与返回的数据都不少字段。后来我想,难道是时间问题?但是我清楚的记得我用的是退货接口,退货接口可以支持11天以内的退款,撤销接口只能退当天的,这个我在开发时就知道了也避开了。所以不大可能是接口用错的问题。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这个问题当时没有解决,一直拖到了新年第二天上班。我仔细想了想应该是时间问题。然后对照官方案例,退货的确是要求传当前时间,说明这里没错啊,还有一个地方就是查询了。由于支付不是我开发的,一开始做支付的同事没有把流水号写进数据库,所以我当时就用了银联查询接口去查流水号然后把退款做出来了,后来同事知道我需要流水号,就在回调的时候写进数据库里,但是由于我当时已经做好了退款嫌麻烦还要改,就没动代码。结果,因为懒,出问题了吧。。。<strong>仔细看查询接口发现这里要传的时间是订单一开始的发送时间,问题就出在这里。因为报文格式错误前还返回了查无此订单！！！</strong></p>
<blockquote>
<p>解决:</p>
</blockquote>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;一开始我还是嫌懒,就想着把正确的时间传过去不就好了吗,后来发现他们写得接口里时间是本地生成的,没用到数据库里的时间,我心里那叫一个苦啊,还是要动存储过程啊,罢了罢了,既然还是要动存储过程,那我还是直接通过取流水号来的省事多了,都不需要用到查询接口。。。就当教训吧。千万不要偷懒！</p>

  </section>

</article>

<section class="read-more">
           
    
               
            <div class="read-more-item">
                <span class="read-more-item-dim">新しい記事</span>
                <h2 class="post-list__post-title post-title"><a href="/2017/11/15/Spring学习3/" title="Spring4.0学习3--集合属性">Spring4.0学习3--集合属性</a></h2>
                <p class="excerpt">
                
                接Spring4.0学习2
集合属性List属性值在 Spring中可以通过一组内置的 xml 标签(例如: &amp;lt;list&amp;gt;, &amp;lt;set&amp;gt; 或 &amp;lt;map&amp;gt;) 来配置集合属性.配置 java.util.List 类型的属性, 需要指定 &amp;lt;list&amp;gt;  标签
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2017-11-15T12:24:50.428Z" class="post-list__meta--date date">2017-11-15</time> &#8226; <span class="post-list__meta--tags tags">于 </span><a class="btn-border-small" href="/2017/11/15/Spring学习3/">继续阅读</a></div>
                           
            </div>
        
        
               
            <div class="read-more-item">
                <span class="read-more-item-dim">以前の記事</span>
                <h2 class="post-list__post-title post-title"><a href="/2017/11/11/Spring学习2/" title="Spring4.0学习2 --Spring 中的 Bean 配置">Spring4.0学习2 --Spring 中的 Bean 配置</a></h2>
                <p class="excerpt">
                
                IOC和DI
IOC(Inversion of Control)：其思想是反转资源获取的方向. 传统的资源查找方式要求组件向容器发起请求查找资源. 作为回应, 容器适时的返回资源. 而应用了 IOC 之后, 则是容器主动地将资源推送给它所管理的组件, 组件所要做的仅是选择一种合适的方式来接受资源. 
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2017-11-11T08:39:21.712Z" class="post-list__meta--date date">2017-11-11</time> &#8226; <span class="post-list__meta--tags tags">于 </span><a class="btn-border-small" href="/2017/11/11/Spring学习2/">继续阅读</a></div>
                       
            </div>
        
     
   
   
  
</section>

  

            <footer class="footer">
    <span class="footer__copyright">
        &copy; 2018 lizhongzhen - 本站点采用 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>
       
    </span>
    <span class="footer__copyright">
             - 基于 <a href="http://hexo.io">Hexo</a> 搭建，使用 <a href="https://github.com/monniya/hexo-theme-new-vno ">new-vno</a> 主题，由<a href="https://monniya.com ">@Monniya</a> 修改自 <a href="https://github.com/lenbo-ma/hexo-theme-vno" target="_blank">Vno</a>, 原创出自<a href="http://github.com/onevcat/vno" target="_blank">onevcat</a>
         </span>
       
    
    
</footer>


        </div>
    </div>

     
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-78918255-1', 'auto');
	ga('send', 'pageview');
</script>

    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?9cdad07c755fa23f6aced510c6760e87";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>



    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    
</body>
</html>
