<!DOCTYPE html>
<html lang="z">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>js词法作用域----静态作用域 | Ronaldo</title>
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="学习自《你不知道的javascript》和：https://github.com/mqyqingfeng/Blog/issues/3js采用词法作用域(lexical scoping),也就是静态作用域！！！
词法作用域是由你在写代码时将变量和块作用域写在哪里来决定的。即编写代码的时候作用域就定义好了而不是调用的时候才开始定义。

核心：函数的作用域在函数定义的时候就决定了!!!(很重要)一、词法">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="js词法作用域----静态作用域 | Ronaldo">
    <meta name="twitter:description" content="学习自《你不知道的javascript》和：https://github.com/mqyqingfeng/Blog/issues/3js采用词法作用域(lexical scoping),也就是静态作用域！！！
词法作用域是由你在写代码时将变量和块作用域写在哪里来决定的。即编写代码的时候作用域就定义好了而不是调用的时候才开始定义。

核心：函数的作用域在函数定义的时候就决定了!!!(很重要)一、词法">

    <meta property="og:type" content="article">
    <meta property="og:title" content="js词法作用域----静态作用域 | Ronaldo">
    <meta property="og:description" content="学习自《你不知道的javascript》和：https://github.com/mqyqingfeng/Blog/issues/3js采用词法作用域(lexical scoping),也就是静态作用域！！！
词法作用域是由你在写代码时将变量和块作用域写在哪里来决定的。即编写代码的时候作用域就定义好了而不是调用的时候才开始定义。

核心：函数的作用域在函数定义的时候就决定了!!!(很重要)一、词法">

    
    <meta name="author" content="lizhongzhen">
    
    <link rel="stylesheet" href="/css/vno.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">

    
    <link rel="icon" href="/images/logo.jpg">
    

    <meta name="generator" content="hexo"/>
    
    <link rel="alternate" type="application/rss+xml" title="Ronaldo" href="/atom.xml">
    

    <link rel="canonical" href="http://yoursite.com/2018/01/22/js词法作用域/"/>

                 
</head>

<body class="home-template no-js">
    <script src="//cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>

    
<header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/Daniel.jpg)">
  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/" title="前往 Ronaldo 的主页"><img src="/images/logo.jpg" width="80" alt="Ronaldo logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage for Ronaldo">Ronaldo</a></h1>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description"></p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />

        <div class="navigation-wrapper">
          <div>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="访问博客" class="blog-button">文字阁</a></li>
            
            </ul>
          </nav>
          </div>
          <div>
          <nav class="cover-navigation navigation--social">
  <ul class="navigation">

  <!-- Weibo-->
  
  <li class="navigation__item">
    <a href="http://weibo.com/3298783260/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo" title="我的微博" target="_blank">
      <i class='social fa fa-weibo'></i>
      <span class="label">Weibo</span>
    </a>
  </li> 


  <!-- Github -->
  
  <li class="navigation__item">
    <a href="https://github.com/lizhongzhen11" title="查看我的GitHub主页" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>


<!-- Stack Overflow -->
        

  <!-- Google Plus -->
  

<!-- Facebook -->

  
<!-- Twitter -->

  

  <li class="navigation__item">
    <a href="/atom.xml" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>



  </ul>
</nav>

          </div>
        </div>

      </div>

    </div>

    <div class="panel-cover--overlay cover-purple"></div>
  </div> 
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single">

  <header class="post-header">
    <div class="post-meta">
      <time datetime="2018-01-22T03:40:00.340Z" class="post-list__meta--date date">2018-01-22</time> &#8226; <span class="post-meta__tags tags">于  </span>
      <span class="page-pv">
       阅读 <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>
      </span> 
   
    </div>
    <h1 class="post-title">js词法作用域----静态作用域</h1>
  </header>

  <section class="post">
    <h3 id="学习自《你不知道的javascript》和：https-github-com-mqyqingfeng-Blog-issues-3"><a href="#学习自《你不知道的javascript》和：https-github-com-mqyqingfeng-Blog-issues-3" class="headerlink" title="学习自《你不知道的javascript》和：https://github.com/mqyqingfeng/Blog/issues/3"></a>学习自《你不知道的javascript》和：<a href="https://github.com/mqyqingfeng/Blog/issues/3" target="_blank" rel="external">https://github.com/mqyqingfeng/Blog/issues/3</a></h3><h3 id="js采用词法作用域-lexical-scoping-也就是静态作用域！！！"><a href="#js采用词法作用域-lexical-scoping-也就是静态作用域！！！" class="headerlink" title="js采用词法作用域(lexical scoping),也就是静态作用域！！！"></a>js采用词法作用域(lexical scoping),也就是静态作用域！！！</h3><blockquote>
<p>词法作用域是由你在写代码时将变量和块作用域写在哪里来决定的。即编写代码的时候作用域就定义好了而不是调用的时候才开始定义。</p>
</blockquote>
<h3 id="核心：函数的作用域在函数定义的时候就决定了-很重要"><a href="#核心：函数的作用域在函数定义的时候就决定了-很重要" class="headerlink" title="核心：函数的作用域在函数定义的时候就决定了!!!(很重要)"></a>核心：函数的作用域在函数定义的时候就决定了!!!(很重要)</h3><h2 id="一、词法作用域的浅略理解"><a href="#一、词法作用域的浅略理解" class="headerlink" title="一、词法作用域的浅略理解"></a>一、词法作用域的浅略理解</h2><p>以下例子来自《你不知道的JavaScript》<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">function foo(a) &#123;</div><div class="line">    var b = a * 2;</div><div class="line">    function bar(c) &#123;</div><div class="line">        console.log(a, b, c)</div><div class="line">    &#125;</div><div class="line">    bar( b * 3 );</div><div class="line">&#125;</div><div class="line">foo(2); // 2,4,12</div></pre></td></tr></table></figure></p>
<p>上面的例子有三个逐级嵌套的作用域。<br>由内到外排列分别是：<code>bar()</code>作用域 —— <code>foo()</code>作用域 —— 全局作用域<br>我们通过上面代码能看到的是：</p>
<ul>
<li>全局作用域里只有一个函数<code>foo</code></li>
<li><code>foo()</code>作用域里有变量<code>b</code>,函数<code>bar</code>,以及<code>foo()</code>的形参<code>a</code>,一共三个标识符。</li>
<li><code>bar()</code>作用域里只有一个形参<code>c</code></li>
</ul>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;以上是我们能从代码中看到的。在函数<code>foo</code>定义完成后通过<code>foo(2)</code>传参调用,按照我们开发的思维,把2传进去一步一步走,到了<code>function bar(c)</code>时,我们需要找到调用<code>bar()</code>的地方,就在下方不远处发现是通过<code>bar(b*3)</code>来调用的,然后进入<code>bar()</code>内部,直接就是打印输出了。这是我们一般开发的思路。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;引擎遇到<code>console.log(a,b,c)</code>时会从内往外找<code>a</code>,<code>b</code>,<code>c</code>,即从最内部作用域不断往外部作用域查找所需要的变量,如果找到就停止否则一直找到最外部作用域。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;还有一个值得注意的是,如果嵌套作用域或者父子作用域中存在相同变量名,当引擎需要解析编译该变量名时,从需要解析编译的位置所属作用域开始从内往外查找,直到找到第一个符合的停止。。</p>
<blockquote>
<p>&nbsp;&nbsp;简单来讲就是<strong>作用域查找会在找到第一个匹配的标识符时停止。</strong></p>
</blockquote>
<p>例如:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">var a = 1</div><div class="line">function foo() &#123;</div><div class="line">    var a = 2; </div><div class="line">    function bar() &#123;</div><div class="line">        var a = 3; </div><div class="line">        console.log(a)</div><div class="line">    &#125;; </div><div class="line">    return bar()</div><div class="line">&#125;</div><div class="line">foo() // 3</div></pre></td></tr></table></figure></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;对照上面代码就很好理解了。其实这里涉及到作用域链以及闭包的知识。代码中的<code>bar()</code>外部一般情况下无法访问,但是通过<code>return</code>关键字然后调用父亲<code>foo()</code>便能访问的到。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;书中给该特性起了个名字叫<strong>遮蔽效应</strong>。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;全局作用域中的<code>a</code>可以通过<code>window.a</code>访问到。其实定义在全局作用域内的变量即方法,都可以认为是<code>window</code>的属性或方法。(注意是浏览器情况下)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;如果我们直接在浏览器控制台输出<code>bar()</code>,将会报错<code>Uncaught ReferenceError: bar is not defined</code>。这是因为<code>bar()</code>是写在<code>foo()</code>函数内的,它的爸爸是<code>foo()</code>而不是全局对象(浏览器下是<code>window</code>)。儿子不能越俎代庖,你也可以理解为等级分明。<code>bar()</code>编写时就在<code>foo()</code>内部,所以它的爸爸或者父级作用域以及自己的作用域都定下来了,几乎不能更改。</p>
<blockquote>
<p>所以这里有一个非常重要的点,需要牢记的是<strong>无论函数在哪里被调用,也无论它如何被调用,它的词法作用域都只由函数被声明时所处的位置决定。</strong></p>
</blockquote>
<h2 id="二、欺骗词法"><a href="#二、欺骗词法" class="headerlink" title="二、欺骗词法"></a>二、欺骗词法</h2><p><strong>人是不完美的,我一直坚信不完美的人造不出完美的东西,而且正因为存在不完美所以更有奋斗动力。</strong></p>
<blockquote>
<p>js有两种办法做到在运行时’修改’词法作用域,分别是<code>eval</code>和<code>with</code>。但是,<strong>欺骗词法作用域会导致性能下降。</strong></p>
</blockquote>
<h3 id="eval"><a href="#eval" class="headerlink" title="eval"></a>eval</h3><p>首先,<code>eval</code>接收一个字符串为参数,并将其中的内容视为好像在书写时就存在于程序中这个位置的代码。<br>还是用书上的例子:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">function foo(str, a) &#123;</div><div class="line">    eval(str) // 欺骗</div><div class="line">    console.log(a,b)</div><div class="line">&#125;</div><div class="line">var b = 2</div><div class="line">foo(&quot;var b = 3;&quot;, 1) // 1,3</div></pre></td></tr></table></figure></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;一开始我看到这样的代码也感到不可思议。<code>foo()</code>里面需要打印<code>a</code>和<code>b</code>,传过来的参数只有<code>a</code>,并没有<code>b</code>,内部也没有,只有全局作用域内有且值为<strong>2</strong>,可是打印出来居然是<strong>3</strong>,这就真的很奇怪了。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我试着把<code>eval(str)</code>注释掉,之后打印输出<strong>1,2</strong>。然后我又把<code>var b = 2</code>注释掉,报<code>Uncaught SyntaxError: Unexpected end of input</code>。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;结合这段代码理解开头那句话就容易得多了。这里<code>eval</code>的功能相当于在<code>foo()</code>内部加了个<code>var b = 3</code>。(这里其实是在<code>foo()</code>作用域内<strong>动态</strong>添加局部变量)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;而在实际开发中,<code>eval()</code>通常被用来执行动态创建的代码。例如公司封装的Ext框架中就有很多地方用到,比如<strong>tools.js</strong>里面的<code>tools.GetPopupWindow</code>方法中就有<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">if (eval(classname)) &#123;</div><div class="line">    win = Ext.create(classname, config);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>&nbsp;&nbsp;默认情况下,如果<code>eval()</code>中所执行的代码包含有一个或多个声明(无论是变量还是函数),就会对<code>eval()</code>所处的词法作用域进行修改。<br>&nbsp;&nbsp;<strong>严格模式下不能修改作用域</strong></p>
</blockquote>
<h3 id="with-不推荐用-自己了解"><a href="#with-不推荐用-自己了解" class="headerlink" title="with,不推荐用,自己了解"></a>with,不推荐用,自己了解</h3><h3 id="性能方面"><a href="#性能方面" class="headerlink" title="性能方面"></a>性能方面</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;书中作出了解释,我段位不够,直接copy过来吧。。。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JavaScript 引擎会在编译阶段进行数项的性能优化。其中有些优化依赖于能够根据代码的词法进行静态分析,并预先确定所有变量和函数的定义位置,才能在执行过程中快速找到标识符。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;但如果引擎在代码中发现了<code>eval()</code>或<code>with</code>,它只能简单的<strong>假设</strong>关于标识符位置的判断都是无效的,因为无法在词法分析阶段明确知道<code>eval()</code>会接收到什么代码,这些代码会如何对作用域进行修改,也无法知道传递给<code>with</code>用来创建新词法作用域的对象的内容到底是什么。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;最悲观的情况是如果出现了<code>eval()</code>或<code>with</code>,所有优化可能都是无意义的,因此最简单的做法就是完全不做任何优化。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;如果代码中大量使用<code>eval()</code>或<code>with</code>,那么运行起来一定会变得非常慢。无论引擎多聪明,试图将这些悲观情况的副作用限制在最小范围,也无法避免如果没有这些优化,代码会运行得更慢这个事实。</p>

  </section>

</article>

<section class="read-more">
           
    
               
            <div class="read-more-item">
                <span class="read-more-item-dim">最近的文章</span>
                <h2 class="post-list__post-title post-title"><a href="/2018/01/30/公司内部Ext框架/" title="公司内部Ext框架使用注意事项或者叫开发指南">公司内部Ext框架使用注意事项或者叫开发指南</a></h2>
                <p class="excerpt">
                
                
以下内容不全是我一个人理解分析的,感谢前辈们: 陈德林、徐冬冬、大许磊、沈梁以及黄建雄的帮忙！

公司内部Ext框架是老板在Ext基础上封装好的,使用起来极为方便,基本上就是复制粘贴改数据,但前提是你知道在哪里改。
导航
显示页面
框架学习
OnBeforeFormLoad()
tools.Set
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2018-01-30T07:19:54.284Z" class="post-list__meta--date date">2018-01-30</time> &#8226; <span class="post-list__meta--tags tags">于 </span><a class="btn-border-small" href="/2018/01/30/公司内部Ext框架/">继续阅读</a></div>
                           
            </div>
        
        
               
            <div class="read-more-item">
                <span class="read-more-item-dim">更早的文章</span>
                <h2 class="post-list__post-title post-title"><a href="/2018/01/12/监听对象属性值的改变/" title="学习监听对象属性值改变">学习监听对象属性值改变</a></h2>
                <p class="excerpt">
                
                首先非常感谢：http://hcysun.me/2016/04/28/JavaScript%E5%AE%9E%E7%8E%B0MVVM%E4%B9%8B%E6%88%91%E5%B0%B1%E6%98%AF%E6%83%B3%E7%9B%91%E6%B5%8B%E4%B8%80%E4%B8%AA%E
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2018-01-12T08:56:39.829Z" class="post-list__meta--date date">2018-01-12</time> &#8226; <span class="post-list__meta--tags tags">于 </span><a class="btn-border-small" href="/2018/01/12/监听对象属性值的改变/">继续阅读</a></div>
                       
            </div>
        
     
   
   
  
</section>

  

            <footer class="footer">
    <span class="footer__copyright">
        &copy; 2018 lizhongzhen - 本站点采用 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>
       
    </span>
    <span class="footer__copyright">
             - 基于 <a href="http://hexo.io">Hexo</a> 搭建，使用 <a href="https://github.com/monniya/hexo-theme-new-vno ">new-vno</a> 主题，由<a href="https://monniya.com ">@Monniya</a> 修改自 <a href="https://github.com/lenbo-ma/hexo-theme-vno" target="_blank">Vno</a>, 原创出自<a href="http://github.com/onevcat/vno" target="_blank">onevcat</a>
         </span>
       
    
    
</footer>


        </div>
    </div>

     
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-78918255-1', 'auto');
	ga('send', 'pageview');
</script>

    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?9cdad07c755fa23f6aced510c6760e87";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>



    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    
</body>
</html>
